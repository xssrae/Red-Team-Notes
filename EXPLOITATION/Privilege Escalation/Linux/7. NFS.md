---
tags:
  - EXPLOITATION
  - Linux
---
Os vetores de escalonamento de privilégios não se limitam ao acesso interno. As pastas compartilhadas e as interfaces de gerenciamento remoto, como SSH e Telnet, também podem ajudá-lo a obter acesso root no sistema de destino. Alguns casos também exigirão o uso de ambos os vetores, por exemplo, encontrar uma chave privada SSH de raiz no sistema de destino e conectar-se via SSH com privilégios de raiz em vez de tentar aumentar o nível de privilégio do usuário atual.

Outro vetor que é mais relevante para CTFs e exames é um shell de rede mal configurado. Às vezes, esse vetor pode ser visto durante os trabalhos de teste de penetração quando um sistema de backup de rede está presente.

A configuração do NFS (Network File Sharing) é mantida no arquivo /etc/exports. Esse arquivo é criado durante a instalação do servidor NFS e geralmente pode ser lido pelos usuários.

![[Pasted image 20231221002437.png]]

O elemento crítico para esse vetor de escalonamento de privilégios é a opção "no_root_squash" que você pode ver acima. Por padrão, o NFS mudará o usuário raiz para nfsnobody e removerá qualquer arquivo da operação com privilégios de raiz. Se a opção "no_root_squash" estiver presente em um compartilhamento gravável, poderemos criar um executável com o bit SUID definido e executá-lo no sistema de destino.

Começaremos enumerando os compartilhamentos montáveis de nossa máquina atacante.

![[Pasted image 20231221002510.png]]

Montaremos um dos compartilhamentos "no_root_squash" em nossa máquina de ataque e começaremos a criar nosso executável.

![[Pasted image 20231221002534.png]]

Como podemos definir os bits SUID, um simples executável que executará o /bin/bash no sistema de destino fará o trabalho.

![[Pasted image 20231221002635.png]]

Quando compilarmos o código, definiremos o bit SUID.

![[Pasted image 20231221002658.png]]

Você verá abaixo que ambos os arquivos (nfs.c e nfs estão presentes no sistema de destino. Trabalhamos no compartilhamento montado, portanto, não houve necessidade de transferi-los).

![[Pasted image 20231221002713.png]]