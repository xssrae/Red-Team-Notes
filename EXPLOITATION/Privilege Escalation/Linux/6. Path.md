---
tags:
  - EXPLOITATION
  - Linux
---
Se uma pasta para a qual o usuário tem permissão de gravação estiver localizada no caminho, é possível sequestrar um aplicativo para executar um script. PATH no Linux é uma variável ambiental que informa ao sistema operacional onde procurar executáveis. Para qualquer comando que não esteja incorporado ao shell ou que não esteja definido com um caminho absoluto, o Linux começará a pesquisar nas pastas definidas em PATH. (PATH é a variável ambiental de que estamos falando aqui, caminho é o local de um arquivo).

Normalmente, o PATH terá a seguinte aparência:

![[Pasted image 20231221000802.png]]

Se digitarmos "thm" na linha de comando, esses são os locais em que o Linux procurará um executável chamado thm. O cenário abaixo lhe dará uma ideia melhor de como isso pode ser aproveitado para aumentar nosso nível de privilégio. Como você verá, isso depende inteiramente da configuração existente do sistema de destino, portanto, certifique-se de que pode responder às perguntas abaixo antes de tentar fazer isso.

    Quais pastas estão localizadas em $PATH
    Seu usuário atual tem privilégios de gravação em alguma dessas pastas?
    Você pode modificar $PATH?
    Há algum script/aplicativo que você possa iniciar e que será afetado por essa vulnerabilidade?

Para fins de demonstração, usaremos o script abaixo:

![[Pasted image 20231221000849.png]]

Esse script tenta iniciar um binário do sistema chamado "thm", mas o exemplo pode ser facilmente replicado com qualquer binário.


Compilamos isso em um executável e definimos o bit SUID.

![[Pasted image 20231221000909.png]]

Uma vez executado, o "path" procurará um executável chamado "thm" dentro das pastas listadas em PATH.

Se alguma pasta gravável estiver listada no PATH, poderemos criar um binário chamado thm nesse diretório e fazer com que o script "path" o execute. Como o bit SUID está definido, esse binário será executado com privilégio de root

Uma pesquisa simples de pastas graváveis pode ser feita usando o comando "find / -writable 2>/dev/null". A saída desse comando pode ser limpa usando uma sequência simples de corte e classificação.

![[Pasted image 20231221000930.png]]


Alguns cenários de CTF podem apresentar pastas diferentes, mas um sistema normal produziria algo como o que vemos acima.

A comparação com o PATH nos ajudará a encontrar as pastas que podemos usar.

![[Pasted image 20231221001009.png]]

Vemos várias pastas em /usr, portanto, pode ser mais fácil executar nossa pesquisa de pastas graváveis mais uma vez para abranger as subpastas.

![[Pasted image 20231221001049.png]]

Uma alternativa poderia ser o comando abaixo.

find / -writable 2>/dev/null | cut -d "/" -f 2,3 | grep -v proc | sort -u

Adicionamos "grep -v proc" para nos livrarmos dos muitos resultados relacionados a processos em execução.

Infelizmente, as subpastas em /usr não podem ser gravadas

A pasta que será mais fácil de gravar é provavelmente /tmp. Neste ponto, como /tmp não está presente no PATH, precisaremos adicioná-la. Como podemos ver abaixo, o comando "export PATH=/tmp:$PATH" faz isso.

![[Pasted image 20231221001206.png]]

Nesse momento, o script de caminho também procurará na pasta /tmp um executável chamado "thm".

![[Pasted image 20231221001754.png]]

Concedemos direitos de execução à nossa cópia do /bin/bash; observe que, nesse momento, ele será executado com os direitos do nosso usuário. O que torna possível o escalonamento de privilégios nesse contexto é o fato de o script de caminho ser executado com privilégios de raiz.

![[Pasted image 20231221001742.png]]