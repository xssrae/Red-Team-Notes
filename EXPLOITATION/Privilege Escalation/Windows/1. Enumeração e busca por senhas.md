---
tags:
  - EXPLOITATION
  - Windows
---
A maneira mais fácil de obter acesso a outro usuário é **reunir credenciais de um computador comprometido**. 

# Instalações autônomas do Windows

Ao instalar o Windows em um grande número de hosts, os administradores podem usar o *Windows Deployment Services*, que permite que uma única imagem do sistema operacional seja implantada em vários hosts por meio da rede. Esses tipos de instalações são chamados de instalações não assistidas, pois não exigem interação do usuário. Essas instalações exigem o uso de uma conta de administrador para realizar a configuração inicial, que pode acabar sendo armazenada na máquina nos seguintes locais:

    C:\Unattend.xml
    C:\Windows\Panther\Unattend.xml
    C:\Windows\Panther\Unattend\Unattend.xml
    C:\Windows\system32\sysprep.inf
    C:\Windows\system32\sysprep\sysprep.xml

Como parte desses arquivos, você pode encontrar credenciais:

```html
<Credentials>
    <Username>Administrator</Username>
    <Domain>thm.local</Domain>
    <Password>MyPassword123</Password>
</Credentials>
```

# Histórico do Powershell

Sempre que um usuário executa um comando usando o Powershell, ele **é armazenado em um arquivo que mantém uma memória de comandos anteriores**. Isso é útil para repetir rapidamente comandos que você já usou antes. Se um usuário executar um comando que inclua uma senha diretamente como parte da linha de comando do Powershell, ela poderá ser recuperada posteriormente usando o seguinte comando em um prompt cmd.exe:

```powershell
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
```

# Credenciais salvas do Windows

O Windows nos permite **usar as credenciais de outros usuários**. Essa função também oferece a opção de salvar essas credenciais no sistema. O comando abaixo listará as credenciais salvas:

```powershell
cmdkey /list
```

Embora não seja possível ver as senhas reais, se você notar alguma credencial que valha a pena tentar, poderá usá-la com o comando runas e a opção `/savecred`, conforme mostrado abaixo.

```powershell
runas /savecred /user:admin cmd.exe
```

# Configuração do IIS

O Internet Information Services (IIS) é o servidor da Web padrão nas instalações do Windows. A configuração de sites no IIS é armazenada em um arquivo chamado web.config e pode armazenar senhas de bancos de dados ou mecanismos de autenticação configurados. Dependendo da versão instalada do IIS, podemos encontrar o web.config em um dos seguintes locais:

    C:\inetpub\wwwroot\web.config
    C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config

Aqui está uma maneira rápida de localizar as cadeias de conexão do banco de dados no arquivo:

```powershell
type C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config | findstr connectionString
```

# Recuperar credenciais do software: PuTTY

O **PuTTY é um cliente SSH comumente encontrado em sistemas Windows**. Em vez de ter que especificar os parâmetros de uma conexão todas as vezes, os usuários podem armazenar sessões nas quais o IP, o usuário e outras configurações podem ser armazenados para uso posterior. Embora o PuTTY não permita que os usuários armazenem suas senhas SSH, ele armazenará configurações de proxy que incluem credenciais de autenticação de texto não criptografado.

Para recuperar as credenciais de proxy armazenadas, você pode procurar na seguinte chave de registro por ProxyPassword com o seguinte comando:

```powershell
reg query HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions\ /f "Proxy" /s
```

>Observação: Simon Tatham é o *criador* do PuTTY (e seu nome faz parte do caminho), não o nome de usuário para o qual estamos recuperando a senha. O nome de usuário do proxy armazenado também deve estar visível após a execução do comando acima.

Assim como o Putty armazena credenciais, qualquer software que armazene senhas, incluindo navegadores, clientes de e-mail, clientes FTP, clientes SSH, software VNC e outros, terá métodos para recuperar as senhas que o usuário salvou.